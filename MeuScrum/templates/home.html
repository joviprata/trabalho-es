<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Projetos - MeuScrum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="header">
        <div class="header-logo">
            <img src="{{ url_for('static', filename='Imagens/logo.png') }}" alt="MeuScrum Logo" onclick="window.location.href='/home'">
            <h2 onclick="window.location.href='/home'">MeuScrum</h2>
        </div>
        <div class="header-actions">
            <button class="btn-icon" onclick="window.location.href='/configuracoes'" title="Configura√ß√µes">
                üë§
            </button>
            <button class="btn-icon" onclick="window.location.href='/home'" title="Home">
                üìù
            </button>
            <button class="btn-icon" onclick="window.location.href='/logout'" title="Sair">
                üö™
            </button>
        </div>
    </div>
    
    <div class="container">
        <div class="content-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h1>Meus Projetos</h1>
                <button class="btn btn-primary" onclick="openNewProjectModal()">+ Novo Projeto</button>
            </div>
            
            <div id="alert-container"></div>
            <div id="projects-container" class="projects-grid">
                <div class="spinner"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal Novo Projeto -->
    <div id="newProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Projeto</h2>
                <button class="modal-close" onclick="closeNewProjectModal()">&times;</button>
            </div>
            <form id="newProjectForm">
                <div class="form-group">
                    <label for="proj-nome">Nome do Projeto</label>
                    <input type="text" id="proj-nome" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="proj-datafim">Data de T√©rmino (opcional)</label>
                    <input type="date" id="proj-datafim" class="form-control">
                </div>
                <div class="form-group">
                    <label for="proj-status">Status</label>
                    <select id="proj-status" class="form-control">
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Pausado">Pausado</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-primary">Criar Projeto</button>
                    <button type="button" class="btn btn-outline" onclick="closeNewProjectModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alert-container');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        async function loadProjects() {
            try {
                const response = await fetch('/api/projetos');
                const data = await response.json();
                const container = document.getElementById('projects-container');
                
                if (data.projetos && data.projetos.length > 0) {
                    container.innerHTML = data.projetos.map(proj => `
                        <div class="project-card" onclick="window.location.href='/projeto/${proj.proj_id}'">
                            <h3>${proj.nome}</h3>
                            <p>In√≠cio: ${new Date(proj.datainicio).toLocaleDateString('pt-BR')}</p>
                            ${proj.datafim ? `<p>T√©rmino: ${new Date(proj.datafim).toLocaleDateString('pt-BR')}</p>` : ''}
                            <div class="project-meta">
                                <span class="project-status status-${getStatusClass(proj.status)}">${proj.status}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-light);">Nenhum projeto encontrado. Crie seu primeiro projeto!</p>';
                }
            } catch (error) {
                showAlert('Erro ao carregar projetos', 'error');
            }
        }
        
        function getStatusClass(status) {
            if (status === 'Conclu√≠do') return 'completed';
            if (status === 'Pausado') return 'paused';
            return 'active';
        }
        
        function openNewProjectModal() {
            document.getElementById('newProjectModal').classList.add('active');
        }
        
        function closeNewProjectModal() {
            document.getElementById('newProjectModal').classList.remove('active');
            document.getElementById('newProjectForm').reset();
        }
        
        document.getElementById('newProjectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nome = document.getElementById('proj-nome').value;
            const datafim = document.getElementById('proj-datafim').value || null;
            const status = document.getElementById('proj-status').value;
            
            try {
                const response = await fetch('/api/projeto', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nome, datafim, status })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeNewProjectModal();
                    showAlert('Projeto criado com sucesso!', 'success');
                    loadProjects();
                } else {
                    showAlert(data.message || 'Erro ao criar projeto', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar com o servidor', 'error');
            }
        });
        
        // Close modal on outside click
        document.getElementById('newProjectModal').addEventListener('click', (e) => {
            if (e.target.id === 'newProjectModal') {
                closeNewProjectModal();
            }
        });
        
        loadProjects();
    </script>
</body>
</html>

